<% content_for :js_content do %>
  <%= javascript_pack_tag "decidim_accountability" %>
<% end %>

<% content_for :css_content do %>
  <%= stylesheet_pack_tag "decidim_accountability", media: "all" %>
<% end %>

<% content_for :aside do %>
  <h1 class="h1 decorator"><%= t("decidim.components.accountability.name") %></h1>

  <%# REDESIGN_PENDING: Perhaps a cell will fit better %>
  <%= render partial: "status", locals: {
    title: t("decidim.accountability.results.home_header.global_status"),
    progress: progress_calculator(current_scope, nil).present? && progress_calculator(current_scope, nil),
    extra_classes: "accountability__status__lg"
  } %>

  <% if current_component.has_subscopes? %>
    <div class="w-full">
      <ul class="filter-container" data-scope-filters>
        <%
          items = []

          items << [
            url_for(filter: { with_category: category.try(:id) }),
            t("results.filters.all", scope: "decidim.accountability"),
            "apps-2-line",
            nil == current_scope,
            Decidim::Scope.model_name.human(count: 2)
          ];
          items << [
            url_for(filter: { with_scope: current_participatory_space.scope.id, with_category: category.try(:id) }),
            translated_attribute(current_participatory_space.scope.name),
            "price-tag-3-line",
            current_participatory_space.scope.id.to_s == current_scope.to_s,
            Decidim::Scope.model_name.human(count: 1)
          ] if current_participatory_space.scope;

          current_participatory_space.subscopes.map do |scope|
            item = [
              url_for(filter: { with_scope: scope.id, with_category: category.try(:id) }),
              translated_attribute(scope.name),
              "price-tag-3-line",
              scope.id.to_s == current_scope.to_s,
              Decidim::Scope.model_name.human(count: 1)
            ]
            items << item
          end

          items.each do |item| %>

          <li>
            <%= link_to item[0], class: "filter#{ ' is-active' if item[3]}" do %>
              <span class="sr-only"><%= item[4] %></span>
              <%= icon item[2] %>
              <span><%= item[1] %></span>
            <% end %>
          </li>

        <% end %>
      </ul>
    </div>
  <% end %>

<% end %>

<%= render layout: "layouts/decidim/shared/layout_two_col" do %>

  <div class="editor-content"><%== translated_attribute component_settings.intro %></div>

  <%= render partial: "home_categories" %>

<% end %>
