<% add_decidim_meta_tags(
  title: translated_attribute(project.title),
  description: translated_attribute(project.description)
) %>

<%
edit_link(
  resource_locator([project.budget, project]).edit,
  :update,
  :project,
  project: project
)
%>

<% content_for :js_content do %>
  <%= javascript_pack_tag "decidim_budgets" %>
<% end %>

<% content_for :css_content do %>
  <%= stylesheet_pack_tag "decidim_budgets" %>
<% end %>

<%= render partial: "exit_modal" %>

<%# REDESIGN_PENDING: Use the drawer feature to implement this %>
<!-- MOCK CONTENT -->
<button class="button button__secondary button__lg" data-drawer-open>open version</button>
<!-- END MOCK CONTENT -->
<% content_for :drawer_header do %>
  <% unless voting_finished? %>
    <%= render partial: "budget_summary", locals: { include_heading: false } %>
  <% end %>
<% end %>
<%= render layout: "layouts/decidim/shared/drawer" do %>
  <%= cell("decidim/budgets/limit_announcement", budget) %>
  <div class="voting-wrapper">
    <div class="section">
      <% if component_settings.geocoding_enabled? && project.geocoded? %>
        <%= render partial: "decidim/shared/static_map", locals: { icon_name: "projects", geolocalizable: project } %>
      <% end %>
      <%= cell("decidim/budgets/project_selected_status", project, as_label: true) %>
      <%= decidim_sanitize_editor translated_attribute project.description %>
      <%= cell "decidim/budgets/project_tags", project, context: { extra_classes: ["tags--project"] } %>
    </div>
    <%= attachments_for project %>
    <%= linked_resources_for project, :proposals, "included_proposals" %>
    <%= linked_resources_for project, :results, "included_projects" %>

    <%= comments_for project, polymorphic: [project.budget] %>
    <%= resource_reference(project) %>
  </div>
  <% content_for :drawer_aside do %>
    <div class="view-header">
      <div id="project">
        <div class="card extra">
          <div class="card__content">
            <%= cell("decidim/budgets/project_votes_count", project, layout: :one_line, class: "display-block") %>

            <% if voting_finished? %>
              <%= cell("decidim/budgets/project_voted_hint", project, class: "display-block") %>
            <% elsif voting_open? %>
              <%= render partial: "project_budget_button", locals: { project: project } %>
            <% end %>

            <span class="budget__definition-data__title">
              <%= t("budget", scope: "decidim.budgets.projects.show") %>
            </span>
            <div class="budget__definition-data__number"><%= budget_to_currency project.budget_amount %></div>
            <div class="blog__actions-right">
              <%= render partial: "decidim/shared/follow_button", locals: { followable: project, large: false  } %>

              <%= cell "decidim/share_button", nil %>

              <%= cell "decidim/report_button", nil %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
