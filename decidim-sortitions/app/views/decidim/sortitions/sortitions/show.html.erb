<% add_decidim_meta_tags({
  description: decidim_sanitize_editor(translated_attribute(sortition.additional_info)),
  title: decidim_html_escape(translated_attribute(sortition.title)),
  url: sortition_url(sortition.to_param)
}) %>

<%= render layout: "layouts/decidim/shared/layout_item", locals: { back_path: sortition, commentable: sortition } do %>

  <div class="callout success">
    <%= t("introduction", scope: "decidim.sortitions.sortitions.show", reference: sortition.id, target_items: sortition.target_items) %>:
  </div>
  <h1 class="h1 decorator editor-content">
    <%= decidim_html_escape(translated_attribute(sortition.title)) %>
  </h1>
  <div class="h1 decorator editor-content">
    <%= decidim_sanitize_editor translated_attribute sortition.additional_info %>
  </div>
  <%= render partial: "sortition_author", locals: { sortition: sortition } %>
  <% if sortition.cancelled? %>
    <h2 class="title-action__title section-heading"><%= t ".cancelled" %></h2>
    <%= render partial: "sortition_cancel_author", locals: { sortition: sortition } %>
    <%= decidim_sanitize_editor translated_attribute sortition.cancel_reason %>
  <% end %>
  <h2 class="title-action__title section-heading"><%= t("witnesses", scope: "decidim.sortitions.sortitions.show") %></h2>
  <%= decidim_sanitize_editor translated_attribute sortition.witnesses %>

  <% if sortition&.proposals %>
    <h2 id="proposals-count" class="title-action__title section-heading">
      <%= t("proposals_selected_by_sortition", scope: "decidim.sortitions.sortitions.show") %>
    </h2>
    <div id="proposals" class="columns mediumlarge-12 large-12">
      <div class="row small-up-1 medium-up-2 large-up-3 card-grid">
        <%= render partial: "proposal", collection: sortition.proposals %>
      </div>
    </div>
  <% end %>

  <h4 class="section-heading">
    <%= t("candidate_proposal_ids", scope: "decidim.sortitions.sortitions.show") %>
  </h4>
  <%= t("candidate_proposals_info", scope: "decidim.sortitions.sortitions.show", category_label: sortition_category_label(sortition)) %>:
  <%= sortition_proposal_candidate_ids sortition %>

  <% content_for :aside do %>
    <div class="m-bottom">
      <%= link_to :sortitions, class: "small hollow" do %>
        <%= icon "chevron-left", class: "icon--small", role: "img", "aria-hidden": true %>
        <%= t("back", scope: "decidim.sortitions.sortitions.show") %>
      <% end %>
    </div>

    <%= render partial: "results_count", locals: { sortition: sortition } %>

    <section class="extended" id="sortition-details">
      <h4 class="section-heading">
        <%= t("sortition_reproducibility_details", scope: "decidim.sortitions.sortitions.show") %>
      </h4>
    </section>

    <div class="sortition-details-item">
      <span class="sortition-details-title sortition-details-text">
        <%= t("dice_result", scope: "decidim.sortitions.sortitions.show") %>
      </span>
      <span class=sortition-details-text><%= sortition.dice %></span>
    </div>

    <div class="sortition-details-item">
      <span class="sortition-details-title sortition-details-text">
        <%= t("time_seed", scope: "decidim.sortitions.sortitions.show") %>
      </span>
      <span class=sortition-details-text><%= sortition.request_timestamp.to_i %></span>
    </div>

    <div class="sortition-details-item">
      <span class="sortition-details-title sortition-details-text">
        <%= t("mathematical_result", scope: "decidim.sortitions.sortitions.show") %>
      </span>
      <span class=sortition-details-text><%= sortition.seed %></span>
    </div>

    <div class="sortition-details-item">
      <span class="sortition-details-title sortition-details-text">
        <%= t("algorithm", scope: "decidim.sortitions.sortitions.show") %>
      </span>
      <span class=sortition-details-text>
        <%= link_to Decidim::Sortitions.sortition_algorithm,
                    Decidim::Sortitions.sortition_algorithm,
                    target: "_blank",
                    title: t("algorithm", scope: "decidim.sortitions.sortitions.show") %>
      </span>
    </div>

    <%= cell "decidim/share_button", nil %>

  <% end %>
  <% content_for :item_footer do %>
    <%= comments_for sortition %>
    <ul class="drawer-metadata__container">
      <%= content_tag :li, resource_reference(sortition), class: "drawer-metadata__item" %>
    </ul>
  <% end %>
<% end %>
