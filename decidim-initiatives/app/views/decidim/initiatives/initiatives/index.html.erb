<% content_for :js_content do %>
  <%= javascript_pack_tag "decidim_initiatives" %>
<% end %>

<% content_for :css_content do %>
  <%= stylesheet_pack_tag "decidim_initiatives", media: "all" %>
<% end %>

<%
edit_link(
  decidim_admin_initiatives.initiatives_path,
  :read,
  :initiative
)
%>


<% content_for :aside do %>
  <h1 class="h1 decorator">
    <% provide :meta_title, t("initiatives.index.title", scope: "decidim") %>
  </h1>

  <% if Decidim::Initiatives.creation_enabled %>
    <% if current_user && available_initiative_types.size > 1 %>
      <%= link_to create_initiative_path(:select_initiative_type), class: "title-action__action button button__xl button__secondary w-full" do %>
        <%= icon "add-fill" %>
        <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
      <% end %>
    <% elsif current_user %>
      <% if allowed_to?(:create, :initiative, { initiative_type: available_initiative_types.first }) %>
        <%= link_to create_initiative_path(:select_initiative_type), class: "title-action__action button button__xl button__secondary w-full" do %>
          <%= icon "add-fill" %>
          <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
        <% end %>
      <% else %>
        <%= authorized_create_modal_button(available_initiative_types.first, remote: true, class: "title-action__action button button__xl button__secondary w-full") do %>
          <%= icon "add-fill" %>
          <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
        <% end %>
      <% end %>
    <% else %>
      <% content_for(:redirect_after_login) { create_initiative_url(:select_initiative_type) } %>
      <button type="button" class="title-action__action button button__xl button__secondary w-full" data-open="loginModal" aria-controls="loginModal" aria-haspopup="dialog" tabindex="0">
        <%= icon "add-fill" %>
        <%= t("new_initiative", scope: "decidim.initiatives.initiatives.index_header") %>
      </button>
    <% end %>
  <% end %>

  <%= render partial: "filters_small_view" %>
  <%= render partial: "filters" %>
<% end %>

<%= render layout: "layouts/decidim/shared/layout_two_col" do %>
  <%= participatory_space_wrapper do %>
    <%= render partial: "index_header" %>
    <div id="initiatives">
      <%= render partial: "initiatives" %>
    </div>
  <% end %>
<% end %>
