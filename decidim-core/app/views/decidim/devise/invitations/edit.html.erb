<%= render layout: "layouts/decidim/shared/layout_center" do %>

  <div class="flex justify-center">
    <h1 class="h1 decorator my-12"><%= t "devise.invitations.edit.header" %></h1>

    <p class="text-lg text-gray-2">
      <%= t("devise.invitations.edit.subtitle").html_safe %>
    </p>
  </div>

  <%= decidim_form_for resource, namespace: "invitation", as: resource_name, url: invitation_path(resource_name, invite_redirect: params[:invite_redirect]), html: { method: :put, class: "register-form new_user" } do |f| %>
    <%= form_required_explanation %>

    <div class="form__wrapper">
      <%# REDESIGN_PENDING: Finish this form %>

      <p><%= t("sign_up_as.legend", scope: "decidim.devise.registrations.new") %></p>

      <%= f.hidden_field :invitation_token %>

      <%= f.text_field :nickname, help_text: t("devise.invitations.edit.nickname_help", organization: current_organization.name), required: "required", prefix: { value: "@", small: 1, large: 1 }, autocomplete: "nickname" %>

      <% if f.object.class.require_password_on_accepting %>
        <%= f.password_field :password, password_field_options_for(:user).except(:help_text) %>
        <%= f.password_field :password_confirmation, password_field_options_for(:user).except(:help_text) %>
      <% end %>

      <h3><%= t("tos_title", scope: "decidim.devise.registrations.new") %></h3>

      <% terms_and_conditions_summary_content_blocks.each do |content_block| %>
        <%= cell content_block.manifest.cell, content_block %>
      <% end %>

      <% link = link_to t("terms", scope: "decidim.devise.registrations.new"), page_path("terms-and-conditions"), target: "_blank" %>
      <% label = t("tos_agreement", scope: "decidim.devise.registrations.new", link: link) %>
      <%= f.check_box :tos_agreement, label: label, required: "required" %>

      <fieldset>
        <legend><%= t("newsletter_title", scope: "decidim.devise.registrations.new") %></legend>
        <div class="field">
          <%= label_tag :"#{resource_name}[newsletter_notifications]" do %>
            <%= check_box_tag :"#{resource_name}[newsletter_notifications]" %>
            <%= t("newsletter", scope: "decidim.devise.registrations.new") %>
          <% end %>
        </div>
      </fieldset>
    </div>

    <div class="form__wrapper-block">
      <button type="submit" class="button button__lg button__secondary">
        <%= t("devise.invitations.edit.submit_button") %>
        <%= icon "arrow-right-line", class: "fill-current" %>
      </button>
    </div>
  <% end %>
<% end %>
